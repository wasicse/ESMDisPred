Bootstrap:library
From: debian:10

%environment

#Setting the environment variables needed

%help

Singularity container with ESMDisPred framework.

%post

#Installing all dependencies

# Install 
apt-get update 
apt-get install -y --no-install-recommends make build-essential libssl-dev  wget curl llvm libidn11 openjdk-11-jre git nano tcsh  

# ------------------- install ESM2Dispred -------------------
cd /opt
echo "Downloading ESMDisPred"
git clone https://github.com/wasicse/ESMDisPred.git

echo "Installing Pyenv"
export PYENV_ROOT=/opt/pyenv
export PATH="/opt/pyenv/bin:$PATH"
curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash

PYTHON_VERSION=miniconda3-4.7.12
pyenv install ${PYTHON_VERSION} 
echo 'export PATH=/opt/pyenv/versions/miniconda3-4.7.12/bin/:$PATH' >> $SINGULARITY_ENVIRONMENT
export PATH=/opt/pyenv/versions/miniconda3-4.7.12/bin/:$PATH

cd /opt/ESMDisPred
./install_dependencies.sh

%runscript
/bin/bash
cd /opt/ESMDisPred